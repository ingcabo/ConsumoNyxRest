var interceptor = function($q){
return{

		request: function(config){
				console.log(config);
			
				config.headers['key']  = '4TrdcJJPXfpy9fZaMBRYreIwBkKNWjSkrt9fsWgb';
				return config;	
		},

		response: function (result) {
                console.log('Repos:');

               
                console.log(result);
             
                return result;
            },
		responseError:function(rejection){
			console.log('Failed with',rejection.status,'status');
			return $q.rejection(rejection);	

		}

	}

};




var app = angular.module('angularTable',['angularUtils.directives.dirPagination','ui.bootstrap']);
app.config(function ($httpProvider) { 

$httpProvider.interceptors.push(interceptor);


});

app.controller('listdata',function($scope,$http,$uibModal){

		 $scope.loading = true;	
			
		 angular.element(document).ready(function () {
    		$scope.getCompras();
   	 });
		


		$scope.getCompras=function(){
				$scope.compras=[];
				$scope.idtext2='';
				$scope.url = "http://www.nyxvzla.com/NyxapiRest/index.php/myquery/compra/";
				$http.get($scope.url+$scope.idtext2)
				.success(function(data){
				 $scope.loading = false;	
				$scope.compras = data;


						
				})
				.error(function(data){
				 $scope.loading = false;	
				alert('Error Conexion');
				
				$scope.compras = data;
				});

				
				$scope.sort =function(keyname){
					
						$scope.sortKey=keyname;
						$scope.reverse=!$scope.reverse;
				
				
				}

			}


				$scope.showDetalle = function(idlote){
     			
					
     				var modalInstance = $uibModal.open({
					templateUrl: 'detallecompra.html',
					controller : 'detalleController',
					windowClass: 'large-Modal',
					 resolve: {
       							   idlote: function() {
       								return idlote;
       							   }
      							}

						});




						
													


     				


				};





})
.controller('detalleController',function($scope,$uibModalInstance,$http,idlote){

				      $scope.loadingd = true;		
					
 					angular.element(document).ready(function () {
    					
    					$scope.getComprast();
    					$scope.getComprasd();

   					 });
		



				$scope.cancel=function(){
				$uibModalInstance.dismiss('cancel');
				};





				$scope.getComprasd=function(){
				$scope.comprasd=[];
				$scope.idtext2= idlote;
				$scope.url = "http://www.nyxvzla.com/NyxapiRest/index.php/myquery/detallecompra/";
				$http.get($scope.url+$scope.idtext2)
				.success(function(data){

					$scope.loadingd = false;				
				$scope.comprasd = data.data;
		
						
				})
				.error(function(data){
					$scope.loadingd = false;	
				
				$scope.comprasd = data;
				});		
		
		}



		$scope.getComprast=function(){
				$scope.comprasd=[];
				$scope.idtext3= idlote;
				$scope.urlt = "http://www.nyxvzla.com/NyxapiRest/index.php/myquery/compra/";
				$http.get($scope.urlt+$scope.idtext3)
				.success(function(data){
				
			
				$scope.compraT = data.data;

				if ($scope.compraT[0].estado_compra == 'Aprobada') {
				    $scope.valert = "alert alert-success";
				}else {

					$scope.valert= "alert alert-danger";
				}
						
				})
				.error(function(data){
				
				
				$scope.compraT = data;
				});		
		
		}

		$scope.sort =function(keyname){
					
						$scope.sortKey=keyname;
						$scope.reverse=!$scope.reverse;
				
				
				}

	});

